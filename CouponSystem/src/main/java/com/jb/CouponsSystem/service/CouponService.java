package com.jb.CouponsSystem.service;

import java.sql.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.jb.CouponsSystem.beans.Coupon;
import com.jb.CouponsSystem.repo.CouponRepository;

@Service
public class CouponService {

	@Autowired
	private CouponRepository couponRepository;

	public void addCoupon(Coupon coupon) {
		couponRepository.save(coupon);
	}

	public void deleteCoupon(long couponId) {
		couponRepository.deleteById(couponId);
	}

	public List<Coupon> getAllCoupons() {
		return (List<Coupon>) couponRepository.findAll();
	}

	public Coupon getCouponById(long couponId) {
		return couponRepository.getOne(couponId);
	}

	public void setCouponAmount(long couponId, int couponAmount) {// Custom query
		couponRepository.setAmountById(couponId, couponAmount);
	}

	public void addCouponCustomer(long couponId, long customerId) {// Custom query
		couponRepository.addCouponCustomer(couponId, customerId);
	};

	public boolean hasCustomerId(long couponId, long customerId) {// Custom query
		try {
			if (couponRepository.findByIdByCustomerId(couponId, customerId) >= 0)
				return true;
		} catch (Exception e) {
		}
		return false;
	}

	public int getAmount(long couponId) {// Custom query
		try {
			return couponRepository.findAmountById(couponId);
		} catch (Exception e) {
		}
		return -1;
	}

	public Date getEndDate(long couponId) { // Custom query; Surround by try/catch!
		return couponRepository.findEndDateById(couponId);
	}

	public List<Coupon> getCouponsByCompanyId(long companyId) {
		return couponRepository.findAllByCompanyId(companyId);
	}

//	public List<Coupon> getCouponsByCompanyIdAndCategoryId(long companyId, long categoryId) {
//		return couponRepository.findAllByCompanyIdAndCategoryId(companyId, categoryId);
//	}

	public List<Coupon> getCouponsByCompanyIdBetweenPrices(long companyId, Double minPrice, Double maxPrice) {
		return couponRepository.findAllByCompanyBetweenPrices(companyId, minPrice, maxPrice);
	}

}
